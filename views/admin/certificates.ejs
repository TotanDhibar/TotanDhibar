<%- include('layout', {
    title: title,
    body: `
    <div class="row">
        <!-- EDIT HERE: Upload New Certificate Card -->
        <div class="col-md-4">
            <div class="card card-primary">
                <div class="card-header">
                    <h3 class="card-title"><i class="fas fa-upload mr-1"></i> Upload New Certificate</h3>
                </div>
                <form method="POST" action="/admin/certificates/add" enctype="multipart/form-data">
                    <input type="hidden" name="uploadType" value="certificates">
                    <div class="card-body">
                        <div class="form-group">
                            <label for="title"><i class="fas fa-tag mr-1"></i> Title <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="title" name="title" required placeholder="Certificate title">
                        </div>
                        
                        <div class="form-group">
                            <label for="description"><i class="fas fa-align-left mr-1"></i> Description</label>
                            <textarea class="form-control" id="description" name="description" rows="3" placeholder="Brief description (optional)"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label><i class="fas fa-file mr-1"></i> File <span class="text-danger">*</span></label>
                            <div class="custom-file">
                                <input type="file" class="custom-file-input" id="file" name="file" accept=".pdf,.jpg,.jpeg,.png,.gif" required>
                                <label class="custom-file-label" for="file">Choose file</label>
                            </div>
                            <small class="text-muted">Accepted: PDF, JPG, JPEG, PNG, GIF</small>
                        </div>
                    </div>
                    <div class="card-footer">
                        <button type="submit" class="btn btn-primary btn-block">
                            <i class="fas fa-upload mr-1"></i> Upload Certificate
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- EDIT HERE: Uploaded Certificates Card -->
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title"><i class="fas fa-certificate mr-1"></i> Uploaded Certificates</h3>
                </div>
                <div class="card-body table-responsive p-0">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Description</th>
                                <th>Upload Date</th>
                                <th style="width: 200px">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
` + (certificates && certificates.length > 0 ? certificates.map(cert => `
                            <tr>
                                <td><strong>${cert.title}</strong></td>
                                <td>${cert.description || '<span class="text-muted">No description</span>'}</td>
                                <td><small>${new Date(cert.upload_date).toLocaleDateString()}</small></td>
                                <td>
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-sm btn-info" onclick="previewCertificate('${cert.file_path}', '${cert.title}')" title="Preview">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <a href="${cert.file_path}" class="btn btn-sm btn-secondary" target="_blank" download title="Download">
                                            <i class="fas fa-download"></i>
                                        </a>
                                        <form method="POST" action="/admin/certificates/delete/${cert.id}" style="display:inline;" onsubmit="return confirm('Delete this certificate?');">
                                            <button type="submit" class="btn btn-sm btn-danger" title="Delete">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
`).join('') : '<tr><td colspan="4" class="text-center text-muted p-4">No certificates uploaded yet</td></tr>') + `
                        </tbody>
                    </table>
                </div>
                <div class="card-footer clearfix">
                    <span class="text-muted">Total: ${certificates ? certificates.length : 0} certificates</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- EDIT HERE: Certificate Preview Modal -->
    <div class="modal fade" id="certificateModal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-xl" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="certificateTitle">Certificate Preview</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body p-0" style="height: 75vh;">
                    <iframe id="pdfViewer" src="" style="width: 100%; height: 100%; border: none;"></iframe>
                    <img id="imageViewer" src="" style="width: 100%; max-height: 100%; object-fit: contain; display: none;">
                </div>
            </div>
        </div>
    </div>
    `,
    extraScripts: `
    <script>
        // EDIT HERE: Custom file input label update
        document.querySelector('.custom-file-input').addEventListener('change', function(e) {
            var fileName = e.target.files[0] ? e.target.files[0].name : 'Choose file';
            e.target.nextElementSibling.textContent = fileName;
        });
        
        // EDIT HERE: Preview certificate function
        function previewCertificate(filePath, title) {
            // Validate file path
            if (!filePath.startsWith('/uploads/') || filePath.includes('..')) {
                alert('Invalid file path');
                return;
            }
            
            document.getElementById('certificateTitle').textContent = title;
            
            var fileExt = filePath.split('.').pop().toLowerCase();
            var allowedExtensions = ['pdf', 'jpg', 'jpeg', 'png', 'webp'];
            
            if (!allowedExtensions.includes(fileExt)) {
                alert('Unsupported file type');
                return;
            }
            
            var pdfViewer = document.getElementById('pdfViewer');
            var imageViewer = document.getElementById('imageViewer');
            
            if (fileExt === 'pdf') {
                pdfViewer.src = filePath;
                pdfViewer.style.display = 'block';
                imageViewer.style.display = 'none';
            } else {
                imageViewer.src = filePath;
                imageViewer.style.display = 'block';
                pdfViewer.style.display = 'none';
            }
            
            $('#certificateModal').modal('show');
        }
        
        $('#certificateModal').on('hidden.bs.modal', function() {
            document.getElementById('pdfViewer').src = '';
            document.getElementById('imageViewer').src = '';
        });
    </script>
    `
}) %>
