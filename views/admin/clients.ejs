<%
// EDIT HERE: HTML escape helper function for XSS prevention
function escapeHtml(str) {
    if (str == null) return '';
    return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
}
%>
<%- include('layout', {
    title: title,
    body: `
    <!-- EDIT HERE: Page Header with Add Button -->
    <div class="row mb-3">
        <div class="col-12">
            <a href="/admin/clients/add" class="btn btn-primary">
                <i class="fas fa-plus mr-1"></i> Add New Client
            </a>
        </div>
    </div>
    
    <!-- EDIT HERE: Clients Table Card -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title"><i class="fas fa-building mr-1"></i> All Clients</h3>
            <div class="card-tools">
                <div class="input-group input-group-sm" style="width: 200px;">
                    <input type="text" class="form-control float-right" placeholder="Search" id="clientSearch">
                    <div class="input-group-append">
                        <button type="button" class="btn btn-default">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="card-body table-responsive p-0">
            <table class="table table-hover" id="clientsTable">
                <thead>
                    <tr>
                        <th style="width: 80px">Logo</th>
                        <th>Client Name</th>
                        <th>Description</th>
                        <th style="width: 80px">Order</th>
                        <th style="width: 150px">Actions</th>
                    </tr>
                </thead>
                <tbody>
` + (clients && clients.length > 0 ? clients.map(client => `
                    <tr>
                        <td>
                            ${client.logo ? '<img src="' + encodeURI(client.logo) + '" class="img-thumbnail" style="max-width:60px; max-height:60px;" alt="' + escapeHtml(client.name) + '">' : '<span class="badge badge-secondary">No Logo</span>'}
                        </td>
                        <td>
                            <strong>${escapeHtml(client.name)}</strong>
                            ${client.website ? '<br><small class="text-muted"><i class="fas fa-globe"></i> <a href="' + encodeURI(client.website) + '" target="_blank" rel="noopener noreferrer">Website</a></small>' : ''}
                        </td>
                        <td>${client.description ? escapeHtml(client.description.length > 50 ? client.description.substring(0, 50) + '...' : client.description) : '<span class="text-muted">No description</span>'}</td>
                        <td><span class="badge badge-info">${parseInt(client.order_index) || 0}</span></td>
                        <td>
                            <div class="btn-group">
                                <a href="/admin/clients/edit/${parseInt(client.id)}" class="btn btn-sm btn-info" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <a href="/clients/${encodeURIComponent(client.slug)}" class="btn btn-sm btn-secondary" title="View" target="_blank">
                                    <i class="fas fa-eye"></i>
                                </a>
                                <form method="POST" action="/admin/clients/delete/${parseInt(client.id)}" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this client?');">
                                    <button type="submit" class="btn btn-sm btn-danger" title="Delete">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>
`).join('') : '<tr><td colspan="5" class="text-center text-muted p-4">No clients found. <a href="/admin/clients/add">Add your first client</a></td></tr>') + `
                </tbody>
            </table>
        </div>
        <div class="card-footer clearfix">
            <span class="text-muted">Total: ${clients ? clients.length : 0} clients</span>
        </div>
    </div>
    `,
    extraScripts: `
    <script>
        // EDIT HERE: Simple table search
        document.getElementById('clientSearch').addEventListener('keyup', function() {
            var searchText = this.value.toLowerCase();
            var rows = document.querySelectorAll('#clientsTable tbody tr');
            rows.forEach(function(row) {
                var text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchText) ? '' : 'none';
            });
        });
    </script>
    `
}) %>
